#! /usr/bin/bash
#*
#*                 _    __ _ _
#*  __ _ ___  __ _| |_ / _(_) |___ ___  WEBSITE: https://goatfiles.github.io
#* / _` / _ \/ _` |  _|  _| | / -_|_-<  REPOS: https://github.com/goatfiles
#* \__, \___/\__,_|\__|_| |_|_\___/__/  LICENCE: https://github.com/goatfiles/dotfiles/blob/main/LICENSE
#* |___/
#*          MAINTAINERS:
#*              AMTOINE: https://github.com/amtoine antoine#1306 7C5EE50BA27B86B7F9D5A7BA37AAE9B486CFF1AB
#*              ATXR:    https://github.com/atxr    atxr#6214    AF97503EDC65A06845114630F00A52147514670B
#*

# parse the input.
while [[ $# -gt 0 ]]; do
  key="$1"

  case $key in
    -e|--on|--enable)
      ENABLE=YES
      shift # past argument
      ;;
    -d|--off|--disable)
      DISABLE=YES
      shift # past argument
      ;;

    -q|--quiet)
      QUIET=YES
      shift # past argument
      ;;

    *)    # unknown option
      POSITIONAL+=("$1") # save it in an array for later
      shift # past argument
      ;;
  esac
done

# some feedback if not quiet.
if [[ ${#POSITIONAL[@]} -eq 1 ]]; then if [[ ! -v QUIET ]]; then echo "unknown flag $POSITIONAL... Aborting."; fi; exit;
else if [[ ${#POSITIONAL[@]} -gt 1 ]]; then if [[ ! -v QUIET ]]; then echo "unknown flags ${POSITIONAL[@]}... Aborting."; fi; exit; fi; fi
if [[ -v ENABLE && -v DISABLE ]]; then if [[ ! -v QUIET ]]; then echo "you cannot enable and disable at the same time... Aborting..."; fi; exit; fi
if [[ ! -v ENABLE && ! -v DISABLE ]]; then if [[ ! -v QUIET ]]; then echo "defaulting to DISABLE"; DISABLE=YES; fi; fi

caps=$(xset -q | grep Caps | cut -d ' '  -f10)

# turn off if on and disables the caps lock key.
if [[ -v DISABLE ]]; then
	if [[ $caps == "on" ]]; then
		if [[ ! -v QUIET ]]; then echo "turning caps_lock off"; fi
		xdotool key Caps_Lock
	fi
	if [[ ! -v QUIET ]]; then echo "disabling caps_lock"; fi
	xmodmap -e "keycode 66=NoSymbol"
	exit
fi

# enables the caps lock key.
if [[ -v ENABLE ]]; then
	if [[ ! -v QUIET ]]; then echo "enabling caps_lock"; fi
	xmodmap -e "keycode 66=Caps_Lock"
fi
